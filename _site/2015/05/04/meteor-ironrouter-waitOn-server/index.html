<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Meteor - How to use iron:router waitOn with an Async Server Call &middot; Curtis Larson's Blog
    
  </title>

  <meta name="description" content="How to use iron:router waitOn with an async server call (Meteor.call)">
  <meta name="keywords" content="meteor, iron router, iron, iron router waitOn, waitOn Meteor.call, waitOn async">

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico?v=2">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Curtis Larson's Blog" href="/blog/atom.xml">

<!-- Mailchimp -->
  <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61702644-1', 'auto');
  ga('send', 'pageview');

</script>
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us11.list-manage.com","uuid":"1c8750215658512459a679f1e","lid":"29a072ab9b"}) })</script>
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/blog/" title="Blog">Curtis Larson's Blog</a>
           &nbsp;&nbsp;&nbsp;<small><a href="/">Main Site</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/archive">Archive</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/atom.xml">Feed</a></small>
          
        </h3>
      </header>

      <main>
        

<article class="post">
  <h1 class="post-title">Meteor - How to use iron:router waitOn with an Async Server Call</h1>
  <time datetime="2015-05-04T00:00:00-04:00" class="page-date">04 May 2015</time>
  <h2 id="how-to-use-ironrouter-waiton-with-an-async-server-call">How to use iron:router waitOn with an Async Server Call</h2>

<p>There have been several <a href="http://stackoverflow.com/questions/29493809/how-to-make-onbeforeaction-call-wait-until-a-function-call-inside-finishes-in-me/">posts</a> about utilizing iron:routerâ€™s <code>waitOn</code> functionality for an async server call. After being disatisfied with a lot of the solutions, including my own in the aforementioned stackoverflow post, I decided to write up a simple solution that had a minimal amount of extra code in the routes file. A couple of problems that I (and many others) ran into included the <code>waitOn</code> function running in an <a href="http://stackoverflow.com/questions/25136239/meteor-0-8-3-iron-router-infinite-loop-inside-waiton-hook">infinite loop</a>, and also <code>waitOn</code> <a href="https://github.com/iron-meteor/iron-router/issues/1031">executing twice</a>.</p>

<h2 id="client-routes-file">Client Routes File</h2>

<p>The client routes.js file is very simple, as the core functionality is contained in a different file. Basically what I am doing is returning a <code>Util.waitOnServer</code> call which will call the <code>testWaitOn</code> Meteor method on the server. You can optionally pass in arguments to <code>Util.waitOnServer</code> to pass data to the Meteor method. Once this call returns, we can then access the data through <code>Util.getResponse</code>.</p>

<script src="https://gist.github.com/quackware/71290757e28d7df89540.js"></script>

<h2 id="utilwaitonserver">Util.waitOnServer</h2>

<p>The Util object contains all the functionality of waiting on <code>Meteor.call</code>. Functionality such as <code>getResponse</code> can be easily changed to something more eloquent, and you can also change the <code>Meteor.call</code> to be any async call. The arugments from <code>Util.waitOnServer</code> are forwarded to the Meteor method here.</p>

<script src="https://gist.github.com/quackware/eea7818fde0cda6a35c3.js"></script>

<h2 id="server-code">Server Code</h2>

<p>The server code is very simple, it just generates a random number and returns it. I also printed out the <code>data</code> argument passed to us from the client. I just wanted a way to make sure everything was being executed in the correct order.</p>

<script src="https://gist.github.com/quackware/703e6cf54c24f7f9b16f.js"></script>

<p>The full source code is available <a href="https://github.com/quackware/meteor-waitOnServer">on my GitHub page</a>. If you have any questions please post them in the comments!</p>


  
    <span>
        <a href="http://www.curtismlarson.com" target="_blank">Curtis Larson</a> |
        <a href="https://twitter.com/quackware" target="_blank">Twitter</a> |
        <a href="mailto:curtis@curtismlarson.com" target="_blank">Email</a>
    </span>
  
  <br/>
  <div id="mc_embed_signup">
<form action="//curtismlarson.us11.list-manage.com/subscribe/post?u=1c8750215658512459a679f1e&amp;id=29a072ab9b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to our mailing list</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_1c8750215658512459a679f1e_29a072ab9b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
</article>

<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'curtismlarson';
  var disqus_identifier = "3699097/2015/05/04/meteor-ironrouter-waitOn-server/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2016/05/31/meteor-connect-to-redis/">
            Meteor 1.3+ - Connect to Redis on the Server
            <small><time datetime="2016-05-31T00:00:00-04:00">31 May 2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/05/12/webpack-cannot-find-module-web-dom-iterable/">
            Webpack - ERROR in Cannot find module '../modules/web.dom.iterable' @ multi main
            <small><time datetime="2016-05-12T00:00:00-04:00">12 May 2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/05/11/mongoose-mongodb-exclude-select-fields/">
            Node - Exclude fields from select with Mongoose/MongoDB
            <small><time datetime="2016-05-11T00:00:00-04:00">11 May 2016</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

      </main>
      <footer class="footer">
        <small>
          &copy; <time datetime="2016-05-31T10:22:52-04:00">2016</time> Curtis Larson. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
