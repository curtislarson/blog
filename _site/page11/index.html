<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Curtis Larson's Blog &middot; A lot of software talk.
    
  </title>

  
  

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico?v=2">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Curtis Larson's Blog" href="/blog/atom.xml">

<!-- Mailchimp -->
  <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61702644-1', 'auto');
  ga('send', 'pageview');

</script>
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us11.list-manage.com","uuid":"1c8750215658512459a679f1e","lid":"29a072ab9b"}) })</script>
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/blog/" title="Blog">Curtis Larson's Blog</a>
           &nbsp;&nbsp;&nbsp;<small><a href="/">Main Site</a></small>
           &nbsp;&nbsp;&nbsp;<small><a href="/#portfolio">Portfolio</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/archive">Archive</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/atom.xml">Feed</a></small>
          
        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/blog/2015/11/20/meteor-wrap-publish-npm-package/">
        Meteor - Wrap and Publish a NPM package
      </a>
    </h1>

    <time datetime="2015-11-20T00:00:00-08:00" class="post-date">20 Nov 2015</time>

    <h2 id="introduction">Introduction</h2>

<p>Building off of my previous tutorial on <a href="www.curtismlarson.com/blog/2015/11/19/meteor-how-to-create-package/">how to create a package in Meteor</a> I decided to create another tutorial on how to wrap and publish a NPM package. There are thousands of useful npm packages that can be used through <code>meteorhacks:npm</code>, but sometimes it’s nice to create a meteor smart package and add some extra functionality to make it even easier to include in your project.</p>

<p>For this tutorial I will be wrapping the <a href="https://github.com/t3chnoboy/amazon-product-api">Amazon Product Api</a> Node.js client. The full source code for the Meteor package is available on my GitHub <a href="https://github.com/quackware/meteor-amazon-product-api">here</a>.</p>

<h2 id="the-steps">The Steps</h2>

<h3 id="create-a-package">1. Create a package</h3>

<p>Similar to the <a href="www.curtismlarson.com/blog/2015/11/19/meteor-how-to-create-package/">how to create a package</a> tutorial, we need to create a new package.</p>

<pre><code>meteor create --package atmosphereusername:packagename
</code></pre>

<h3 id="edit-the-packagejs-file">2. Edit the package.js file</h3>

<p>Now we need to make some edits to the <code>package.js</code> file to specify our Npm dependency and point the package to our server file where we will be making some Meteor specific customizations. First we add the following Npm dependency</p>

<pre><code>Npm.depends({
  "amazon-product-api": "0.3.5"
});
</code></pre>

<p>And we also need to add an export in the <code>Package.onUse</code> block, we’re going to choose <code>AmazonProductApi</code> as our export.</p>

<pre><code>Package.onUse(function(api) {
  api.versionsFrom('1.2.1');
  api.export("AmazonProductApi");
});
</code></pre>

<p>Finally we need to reference the javascript file in <code>package.js</code> that will glue together the Npm package with Meteor.</p>

<pre><code>Package.onUse(function(api) {
  api.versionsFrom('1.2.1');
  api.export("AmazonProductApi");
  api.addFiles(["server/amazon-product-api.js"], "server");
});
</code></pre>

<h3 id="the-glue-file">3. The Glue File</h3>

<p>Go ahead and create the <code>amazon-product-api.js</code> file.</p>

<pre><code>mkdir server
touch server/amazon-product-api.js
</code></pre>

<p>In this file we can add our <code>Npm.require</code> and setup the object we need to export.</p>

<pre><code>var amazon = Npm.require("amazon-product-api");

AmazonProductApi = {};
</code></pre>

<p>Now the amazon product api package has three functions: <code>itemSearch</code>, <code>itemLookup</code>, and <code>browseNode</code> that are exposed in the <code>createClient</code> function. These functions have a future usage and a callback usage. Let’s go ahead and add a syncronous usage to better use it in our Meteor projects. To do this we just need to add the <code>createClient</code> function to our exported object and wrap the functions using <code>Meteor.wrapAsync</code>. Below is the full code:</p>

<pre><code>var amazon = Npm.require("amazon-product-api");

AmazonProductApi = {};

AmazonProductApi.createClient = function(credentials) {
  var client = amazon.createClient(credentials);
  client.itemSearchSync = Meteor.wrapAsync(client.itemSearch);
  client.itemLookupSync = Meteor.wrapAsync(client.itemLookup);
  client.browseNodeSync = Meteor.wrapAsync(client.browseNode);
  return client;
};
</code></pre>

<h3 id="publishing-to-atmosphere">4. Publishing to Atmosphere</h3>

<p>Now that our package is complete, we can publish it to atmosphere so that other people can use it. Make sure you are in your package directory and type the following command:</p>

<pre><code>meteor publish --create
</code></pre>

<p>Your package should now be built and uploaded to atmosphere.</p>

<h2 id="conclusion">Conclusion</h2>

<p>That’s it! Now whenever someone wants to use the awesome <a href="https://github.com/t3chnoboy/amazon-product-api">Amazon Product Api</a> npm package, they can just type <code>meteor add quackware:amazon-product-api</code>. They can also take advantage of our new syncronous functions we added. Again, the full source code for the Meteor package is available on my GitHub <a href="https://github.com/quackware/meteor-amazon-product-api">here</a>. Leave a message if you have any questions or comments!</p>

    
    <hr/>
    
    <span>
      <a href="http://www.curtismlarson.com" target="_blank">Curtis Larson</a> is a LA based freelance software developer. <a href="https://twitter.com/quackware" target="_blank">Follow him on Twitter</a> or <a href="mailto:curtis@curtismlarson.com" target="_blank">send him an email</a> if your looking for a talented developer.
    </span>
    
    <div id="mc_embed_signup">
<form action="//curtismlarson.us11.list-manage.com/subscribe/post?u=1c8750215658512459a679f1e&amp;id=29a072ab9b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to our mailing list</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_1c8750215658512459a679f1e_29a072ab9b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page12">Older</a>
  
  
    
      <a class="pagination-item newer" href="/blog/page10">Newer</a>
    
  
</div>

      </main>
      <footer class="footer">
        <small>
          &copy; <time datetime="2018-10-03T08:50:26-07:00">2018</time> Curtis Larson. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
