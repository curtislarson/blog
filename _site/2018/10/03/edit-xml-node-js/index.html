<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      How to Read, Write, and Update XML with Node.js &middot; Curtis Larson's Blog
    
  </title>

  <meta name="description" content="How to read, write, and update XML with Node.js">
  <meta name="keywords" content="node, node.js, xml, node write xml, node read xml, node update xml, javascript, javascript xml, node.js xml, node xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico?v=2">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Curtis Larson's Blog" href="/blog/atom.xml">

<!-- Mailchimp -->
  <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61702644-1', 'auto');
  ga('send', 'pageview');

</script>
  <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us11.list-manage.com","uuid":"1c8750215658512459a679f1e","lid":"29a072ab9b"}) })</script>
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/blog/" title="Blog">Curtis Larson's Blog</a>
           &nbsp;&nbsp;&nbsp;<small><a href="/">Main Site</a></small>
           &nbsp;&nbsp;&nbsp;<small><a href="/#portfolio">Portfolio</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/archive">Archive</a></small>
          
           &nbsp;&nbsp;&nbsp;
           <small><a href="/blog/atom.xml">Feed</a></small>
          
        </h3>
      </header>

      <main>
        

<article class="post">
  <h1 class="post-title">How to Read, Write, and Update XML with Node.js</h1>
  <time datetime="2018-10-03T00:00:00+09:00" class="page-date">03 Oct 2018</time>
  <h2 id="introduction">Introduction</h2>

<p>Often times I have to make small edits to XML files provided by clients due to various errors that are in the file or updates that need to be made to the data. Rather than manually edit potentially thousands of lines of XML I usually write a quick script to do the changes automatically. I’ll show you how to easily read, write, and update xml using Node.js and a useful npm package.</p>

<h2 id="setup">Setup</h2>

<p>First off you need to create a directory, run <code>npm init</code> and then run <code>npm install --save xml2json</code> to install the <a href="https://www.npmjs.com/package/xml2json">xml2json</a> package which will be doing the bulk of the work. Make sure to also create a main JavaScript file (like <code>index.js</code>) and have your <code>package.json</code> point to it correctly. Here’s an example of an xml file that needs to be edited:</p>

<pre><code>&lt;Survey&gt;
  &lt;!-- QUESTION 1 --&gt;
  &lt;Question QuestionId='1'&gt;
    &lt;QuestionText&gt;What is the air speed velocity of an unladen swallow?&lt;/QuestionText&gt;
  &lt;/Question&gt;

    &lt;!-- ANSWER 1 --&gt;
  &lt;Answer QuestionId='1' AnswerTypeId='1' DisplayOrder='1' AnswerId='286'&gt;
    &lt;AnswerText&gt;12?&lt;/AnswerText&gt;
  &lt;/Answer&gt;

    &lt;!-- ANSWER 2 --&gt;
  &lt;Answer QuestionId='1' AnswerTypeId='1' DisplayOrder='2' AnswerId='286'&gt;
    &lt;AnswerText&gt;African or European&lt;/AnswerText&gt;
  &lt;/Answer&gt;

    &lt;!-- ANSWER 3 --&gt;
  &lt;Answer QuestionId='1' AnswerTypeId='1' DisplayOrder='3' AnswerId='286'&gt;
    &lt;AnswerText&gt;11 meters per second.&lt;/AnswerText&gt;
  &lt;/Answer&gt;

    &lt;!-- ANSWER 4 --&gt;
  &lt;Answer QuestionId='1' AnswerTypeId='1' DisplayOrder='4' AnswerId='286'&gt;
    &lt;AnswerText&gt;I don’t know.&lt;/AnswerText&gt;
  &lt;/Answer&gt;
&lt;/Survey&gt;
</code></pre>

<p>As you can see in the XML file the <code>AnswerId</code> property is repeated for each answer. This was causing problems with the import script that needed to generate a survey from the XML.</p>

<h2 id="reading-and-parsing-the-xml">Reading and Parsing the XML</h2>

<p>The first step was reading the xml file, which I dropped into the same folder as my main JavaScript file and aptly named it <code>survey.xml</code>. Reading the xml file is as easy as importing the <code>fs</code> package and using the <code>readFile</code> function:</p>

<pre><code>var fs = require('fs');

fs.readFile( './survey.xml', function(err, data) {

});
</code></pre>

<p>Now that we have access to the raw xml data we can throw it into the <code>xml2json</code> parser:</p>

<pre><code>var fs = require('fs');
var parser = require('xml2json');

fs.readFile( './survey.xml', function(err, data) {
  var json = JSON.parse(parser.toJson(data, {reversible: true}));
});
</code></pre>

<p>Using the <code>toJson</code> function allows us to convert a raw XML string into a stringified JSON object. Using <code>JSON.parse</code> will convert that string into a JavaScript object that we can manipulate. Notice the option of <code>{reversible: true}</code> that I passed into the <code>toJson</code> function. This allows us to convert the JSON we manipulate back to conformant XML.</p>

<h2 id="editing-the-xml">Editing the XML</h2>

<p>As mentioned above, we want to make sure that the <code>AnswerId</code> property is unique for each <code>Answer</code>. We can do this by looping through each of the answers and setting it’s <code>AnswerId</code> property to the index of the loop as so:</p>

<pre><code>var fs = require('fs');
var parser = require('xml2json');

fs.readFile( './survey.xml', function(err, data) {
  var json = JSON.parse(parser.toJson(data, {reversible: true}));
  var answers = json["Survey"]["Answer"];
  for (var i = 0; i &lt; answers.length; i++) {
    var answer = answers[i];
    answer.AnswerId = i;
  }
});
</code></pre>

<p>Notice that I accessed <code>json["Survey"]["Answer"]</code> and it returned an array of objects. The JSON object is structured so that each XML element is nested inside it’s parent element as an object property. Elements that are at the same level are just added to an array rather than as separate properties. This allows us to access all Answers at once that are a child of the <code>Survey</code> element.</p>

<h2 id="converting-back-to-xml-and-writing">Converting back to XML and Writing</h2>

<p>Now that we have made the necessary change we can use <code>xml2json.toXml</code> to convert the modified JSON back into xml which we can write back to a file.</p>

<pre><code>fs = require('fs');
var parser = require('xml2json');

fs.readFile( './survey.xml', function(err, data) {
  var json = JSON.parse(parser.toJson(data, {reversible: true}));
  var answers = json["Survey"]["Answer"];
  for (var i = 0; i &lt; answers.length; i++) {
    var answer = answers[i];
    answer.AnswerId = i;
  }

  var stringified = JSON.stringify(json);
  var xml = parser.toXml(stringified);
  fs.writeFile('survey-fixed.xml', xml, function(err, data) {
    if (err) {
      console.log(err);
    }
    else {
      console.log('updated!');
    }
  });
});
</code></pre>

<p>We need to make sure to call <code>JSON.stringify</code> on the JavaScript object before we pass it to the <code>toXML</code> function (which expects a string). Since we used the <code>reversible</code> property we should now have a fully compliant XML file that has fixed <code>AnswerId</code> properties. That’s all you need to know for reading, updating, then writing back an XML file with Node.js. Feel free to leave a comment or ask any questions!</p>

  <hr/>
  
    <span>
      <a href="http://www.curtismlarson.com" target="_blank">Curtis Larson</a> is a LA based freelance software developer. <a href="https://twitter.com/quackware" target="_blank">Follow him on Twitter</a> or <a href="mailto:curtis@curtismlarson.com" target="_blank">send him an email</a> if you're looking for a talented developer.
    </span>
  
  <br/>
  <div id="mc_embed_signup">
<form action="//curtismlarson.us11.list-manage.com/subscribe/post?u=1c8750215658512459a679f1e&amp;id=29a072ab9b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
  <label for="mce-EMAIL">Subscribe to our mailing list</label>
  <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_1c8750215658512459a679f1e_29a072ab9b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
</article>

<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'curtismlarson';
  var disqus_identifier = "3699097/2018/10/03/edit-xml-node-js/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2018/10/01/remote-software-developer-freelance-site-list/">
            Remote Software Developer Freelance Sites
            <small><time datetime="2018-10-01T00:00:00+09:00">01 Oct 2018</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/07/06/webpack-heroku-build-fails-no-error/">
            Webpack & Heroku - Build failure with no error message
            <small><time datetime="2016-07-06T00:00:00+09:00">06 Jul 2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/05/31/meteor-connect-to-redis/">
            Meteor 1.3+ - Connect to Redis on the Server
            <small><time datetime="2016-05-31T00:00:00+09:00">31 May 2016</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

      </main>
      <footer class="footer">
        <small>
          &copy; <time datetime="2019-02-14T11:28:22+09:00">2019</time> Curtis Larson. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
